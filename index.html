<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Via Cumbres Pro - Seguridad</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
    .seccion { display: none; }
    .activo { display: block; }
    .input-v { @apply w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-xl mb-3 outline-none focus:border-purple-500 font-semibold; }
  </style>
 </head>
 <body class="bg-slate-100 font-sans min-h-screen">

  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 flex justify-around p-3 z-50 glass">
    <button onclick="navegar('inicio')" class="text-center group">
        <div class="text-xl group-focus:text-purple-600">üè†</div>
        <span class="text-[10px] font-bold text-slate-400 group-focus:text-purple-600">INICIO</span>
    </button>
    <button onclick="navegar('buscar')" class="text-center group">
        <div class="text-xl">üîç</div>
        <span class="text-[10px] font-bold text-slate-400">BUSCAR</span>
    </button>
    <button onclick="navegar('bitacora')" class="text-center group">
        <div class="text-xl">üìã</div>
        <span class="text-[10px] font-bold text-slate-400">BIT√ÅCORA</span>
    </button>
  </nav>

  <div id="sec-inicio" class="seccion activo p-8 text-center min-h-screen flex flex-col justify-center pb-24">
    <div class="mb-8">
        <h1 class="text-3xl font-black text-slate-900 italic">VIA CUMBRES</h1>
        <p class="text-purple-600 font-bold text-xs tracking-widest uppercase">Sistema de Seguridad</p>
    </div>
    <div class="space-y-3">
        <button onclick="abrirForm('ACCESO 1')" class="w-full bg-purple-600 text-white p-5 rounded-2xl font-black shadow-lg">ACCESO 1</button>
        <button onclick="abrirForm('ACCESO 2')" class="w-full bg-purple-600 text-white p-5 rounded-2xl font-black shadow-lg">ACCESO 2</button>
        <button onclick="abrirForm('PEATONAL')" class="w-full bg-slate-800 text-white p-5 rounded-2xl font-black shadow-lg">PEATONAL</button>
    </div>
  </div>

  <div id="sec-form" class="seccion p-6 pb-24">
    <div class="flex justify-between items-center mb-4">
        <h3 id="form-lugar" class="font-black text-purple-700 bg-purple-100 px-3 py-1 rounded-lg text-sm"></h3>
        <button onclick="navegar('inicio')" class="text-xs font-bold text-slate-400">CANCELAR</button>
    </div>

    <div class="bg-white p-5 rounded-[2rem] shadow-xl border border-white">
        <label class="text-[10px] font-black text-slate-400 uppercase ml-1">Visitante</label>
        <select id="tipo" class="input-v"><option>VISITA</option><option>PROVEEDOR</option><option>RESIDENTE</option></select>
        <input type="text" id="nombre" placeholder="Nombre completo" class="input-v">
        <input type="text" id="domicilio" placeholder="Casa / Lote" class="input-v">

        <label class="text-[10px] font-black text-slate-400 uppercase ml-1">Veh√≠culo (Si aplica)</label>
        <div class="grid grid-cols-2 gap-2">
            <input type="text" id="placa" placeholder="Placas" class="input-v uppercase">
            <input type="text" id="marca" placeholder="Marca" class="input-v">
            <input type="text" id="modelo" placeholder="Modelo" class="input-v">
            <input type="text" id="color" placeholder="Color" class="input-v">
        </div>

        <div class="bg-slate-50 p-4 rounded-xl border-2 border-dashed border-slate-200 mb-6 text-center">
            <input type="file" id="foto" accept="image/*" capture="environment" class="hidden">
            <button onclick="document.getElementById('foto').click()" class="text-xs font-black text-purple-600">üì∏ ADJUNTAR FOTO EVIDENCIA</button>
        </div>

        <button onclick="guardarRegistro()" id="btn-save" class="w-full bg-emerald-500 text-white py-5 rounded-2xl font-black text-lg shadow-emerald-200 shadow-lg">CONFIRMAR REGISTRO</button>
    </div>
  </div>

  <div id="sec-buscar" class="seccion p-6 pb-24">
    <h2 class="text-2xl font-black mb-4">Buscador R√°pido</h2>
    <input type="text" id="input-busqueda" onkeyup="filtrarRegistros()" placeholder="Buscar por Nombre o Placa..." class="input-v mb-4 border-purple-200 shadow-sm">
    <div id="lista-busqueda" class="space-y-3">
        </div>
  </div>

  <div id="sec-bitacora" class="seccion p-6 pb-24">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-black">Registros de Hoy</h2>
        <button onclick="generarReporte()" class="bg-slate-800 text-white px-4 py-2 rounded-xl font-bold text-xs italic">PDF/REPORTE</button>
    </div>
    <div id="lista-bitacora" class="space-y-3">
        </div>
  </div>

  <script>
    let puntoActual = "";
    let db = JSON.parse(localStorage.getItem('viaCumbres_DB')) || [];

    function navegar(id) {
        document.querySelectorAll('.seccion').forEach(s => s.classList.remove('activo'));
        document.getElementById('sec-' + id).classList.add('activo');
        if(id === 'bitacora' || id === 'buscar') actualizarListas();
    }

    function abrirForm(lugar) {
        puntoActual = lugar;
        document.getElementById('form-lugar').innerText = "üìç " + lugar;
        navegar('form');
    }

    function guardarRegistro() {
        const r = {
            id: Date.now(),
            punto: puntoActual,
            tipo: document.getElementById('tipo').value,
            nombre: document.getElementById('nombre').value,
            domicilio: document.getElementById('domicilio').value,
            placa: document.getElementById('placa').value.toUpperCase() || "S/P",
            marca: document.getElementById('marca').value,
            modelo: document.getElementById('modelo').value,
            color: document.getElementById('color').value,
            fecha: new Date().toLocaleDateString(),
            hora: new Date().toLocaleTimeString(),
            status: 'ADENTRO'
        };

        if(!r.nombre || !r.domicilio) return alert("Llena nombre y domicilio");

        db.unshift(r);
        localStorage.setItem('viaCumbres_DB', JSON.stringify(db));
        alert("‚úÖ REGISTRO GUARDADO");
        document.querySelectorAll('input').forEach(i => i.value = "");
        navegar('bitacora');
    }

    function actualizarListas() {
        const bita = document.getElementById('lista-bitacora');
        const search = document.getElementById('lista-busqueda');
        bita.innerHTML = "";
        search.innerHTML = "";

        db.forEach(r => {
            const card = `
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 relative">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-[10px] font-black text-purple-600">${r.tipo} | ${r.punto}</p>
                            <h4 class="font-black text-slate-800 text-lg">${r.nombre}</h4>
                            <p class="text-xs font-bold text-slate-500 italic">Casa: ${r.domicilio}</p>
                            <p class="text-[10px] text-slate-400 mt-1">${r.marca} ${r.color} - [${r.placa}]</p>
                        </div>
                        <span class="text-[9px] font-bold text-slate-400">${r.hora}</span>
                    </div>
                    ${r.status === 'ADENTRO' ? 
                        `<button onclick="marcarSalida(${r.id})" class="mt-3 w-full bg-slate-100 text-slate-600 py-2 rounded-lg text-[10px] font-black hover:bg-red-50 hover:text-red-600 transition-all italic">MARCAR SALIDA</button>` : 
                        `<p class="mt-3 text-center text-[9px] font-black text-emerald-500 uppercase tracking-widest">Ya sali√≥</p>`
                    }
                </div>`;
            bita.innerHTML += card;
            search.innerHTML += card;
        });
    }

    function marcarSalida(id) {
        db = db.map(r => r.id === id ? {...r, status: 'FUERA'} : r);
        localStorage.setItem('viaCumbres_DB', JSON.stringify(db));
        actualizarListas();
    }

    function filtrarRegistros() {
        const query = document.getElementById('input-busqueda').value.toLowerCase();
        document.querySelectorAll('#lista-busqueda > div').forEach(card => {
            card.innerText.toLowerCase().includes(query) ? card.style.display = "block" : card.style.display = "none";
        });
    }

    function generarReporte() {
        let texto = "REPORTE VIA CUMBRES\n" + new Date().toLocaleDateString() + "\n\n";
        db.forEach(r => {
            texto += `[${r.hora}] ${r.nombre} - ${r.domicilio} - Placa: ${r.placa} - (${r.status})\n`;
        });
        const blob = new Blob([texto], {type: "text/plain"});
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "Bitacora_ViaCumbres.txt";
        link.click();
    }
  </script>
 </body>
</html>
